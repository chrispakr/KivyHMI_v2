#:import utils kivy.utils
#:import getHexCol kivy.utils.get_color_from_hex

<IconButton@Button>:
    alpha: 1.0
    imageSource: None
    size_hint: None, None
    size: 74, 65
    background_normal: "pictures/Button_Normal.png"
    background_down: "pictures/Button_Normal.png"
    background_color: app.baseColor
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.6
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Image:
        source: root.imageSource
        size: 50, 50
        center_x: self.parent.center_x
        center_y: self.parent.center_y


<IconButtonToggle@ToggleButton>:
    alpha: 1.0
    imageSource: None
    size_hint: None, None
    size: 74, 65
    background_normal: "pictures/Button_Normal.png"
    background_down: "pictures/Button_Normal.png"
    background_color: app.baseColor
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.6
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Image:
        source: root.imageSource
        size: 50, 50
        center_x: self.parent.center_x
        center_y: self.parent.center_y


<selectLedColorButton@ToggleButton>:
    ledColor: 1,1,0,1
    background_color: 0,0,0,0
    background_down: ""
    background_normal: ""
    canvas.before:
        Color:
            rgb: self.lecColor
            a: 1.0
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]


<NextPicButton@Button>:
    alpha: 1.0
    imageSource: None
    size_hint: None, None
    size: 150, 65
    background_normal: "pictures/Button_NextPic.png"
    background_down: "pictures/Button_NextPic.png"
    background_color: app.baseColor
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Image:
        source: root.imageSource
        size: 50, 50
        center_x: self.parent.center_x
        center_y: self.parent.center_y

<DhButton@Button>:
    alpha: 1.0
    arrowAngle: 0
    curDhPosition: app.curDhPosition
    imageSource: None
    size_hint: None, None
    size: 326, 65
    font_name: "StdFont"
    font_size: 16
    text: "LOWER GLASS"
    background_normal: "pictures/Button_Normal.png"
    background_down: "pictures/Button_Normal.png"
    background_color: app.baseColor
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Image:
        source: root.imageSource
        size: 50, 50
        center_x: self.parent.center_x - 130
        center_y: self.parent.center_y
        canvas.before:
            PushMatrix
            Rotate:
                axis: 0,0,1
                angle: root.arrowAngle
                origin: self.center
        canvas.after:
            PopMatrix
    Image:
        source: root.imageSource
        size: 50, 50
        center_x: self.parent.center_x + 130
        center_y: self.parent.center_y
        canvas.before:
            PushMatrix
            Rotate:
                axis: 0,0,1
                angle: root.arrowAngle * -1
                origin: self.center
        canvas.after:
            PopMatrix


<SelectFilmButton@Button>:
    alpha: 1.0
    filmName: "Color Neg RMK TOP 15"
    size_hint: None, None
    size: 340, 65
    font_name: "StdFont"
    font_size: 16
    background_normal: "pictures/Button_FilmType.png"
    background_down: "pictures/Button_FilmType.png"
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    canvas:
        Color:
            rgb: app.baseColor
        RoundedRectangle:
            pos: self.x, self.y + 45
            size: self.width, 20
            radius: [8,8,0,0]
    Label:
        center_x: root.center_x
        center_y: root.center_y + 22
        color: app.baseBlack
        font_name: "StdFont"
        font_size: 14
        text: "FILMTYPE"
    Label:
        center_x: root.center_x
        center_y: root.center_y - 10
        color: app.baseWhite
        font_name: "StdFont"
        font_size: 16
        text: root.filmName


<StartFilmLoadButton@Button>:
    alpha: 1.0
    #size_hint: None, None
    #size: 340, 45
    font_name: "StdFont"
    font_size: 16
    background_color: 0,0,0,0
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 1.0 if self.state == "normal" else 0.5
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Label:
        center_x: root.center_x
        center_y: root.center_y
        color: app.baseWhite
        font_name: "StdFont"
        font_size: 16
        text: "START LOADING FILM"


<FilmLoadButton@Button>:
    size_hint: None, None
    size: 158, 65
    btnText: ""
    font_name: "StdFontBold"
    font_size: 18
    background_color: 0,0,0,0
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 1.0 if self.state == "normal" else 0.5
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Label:
        center_x: root.center_x
        center_y: root.center_y
        color: app.baseWhite
        font_name: "StdFont"
        font_size: 16
        text: root.btnText


<LoadFilmFfwButton@Button>:
    size_hint: None, None
    size: 326, 65
    background_normal: "pictures/button_LoadFilmFFW.png"
    background_down: "pictures/button_LoadFilmFFW.png"
    background_color: app.baseColor
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]
    Image:
        source: "pictures/icon_LoadFilm_FFW.png"
        size: 50, 50
        center_x: self.parent.center_x
        center_y: self.parent.center_y


<InfoTextLabel@Label>:
    #size_hint: None, None
    #size: 340, 45
    font_name: "StdFontBold"
    font_size: 18
    text: ""
    background_color: 0,0,0,0
    canvas.before:
        Color:
            rgb: app.baseGrey
            #a: 1.0 if self.state == "normal" else 0.5
        Line:
            width: 1.05
            rounded_rectangle: self.x, self.y, self.width, self.height, 8, 50


<MoveFilmButton@Button>:
    alpha: 1.0
    size_hint: None, None
    size: 70, 50
    background_normal: "pictures/Button_Ffw.png"
    background_down: "pictures/Button_Ffw.png"
    font_name: "StdFont"
    font_size: 24
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]


<StopButton@Button>:
    alpha: 1.0
    size_hint: None, None
    size: 180, 50
    background_normal: "pictures/Button_Stop.png"
    background_down: "pictures/Button_Stop.png"
    font_name: "StdFont"
    font_size: 16
    canvas.before:
        Color:
            rgb: app.baseColor
            a: 0.0 if self.state == "normal" else 0.3
        RoundedRectangle:
            pos: self.x, self.y
            size: self.width, self.height
            radius: [8]

<enableFreeRunPopup>:
    Label:
        text: "Do you want disable the motors?"
        size_hint: 0.6, 0.2
        pos_hint: {"x":0.2, "top":0.8}
    BoxLayout:
        orientation: "horizontal"
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        Button:
            text: 'OK, unlock motors...'
            size_hint: 1, 0.4
            on_press:
                app.enable_freerun()

<disableFreeRunPopup>:
    Label:
        text: "Disable FreeRun need a re-initialization of the insert film.\n Do you want to proceed? "
        size_hint: 0.6, 0.2
        pos_hint: {"x":0.2, "top":0.8}
    BoxLayout:
        orientation: "horizontal"
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        Button:
            text: 'Init-Film'
            size_hint: 1, 0.4
            on_press:
                app.disable_freerun_with_initfilm()

<Spool@RelativeLayout>:
    filmDiameter: 0
    arcSpool: 0
    size_hint: None, None
    width: 110
    height: 110
    canvas:
        Color:
            rgb: 0,0,0
        Ellipse:
            pos: 0,0
            size: 110, 110
        Color:
            rgb: getHexCol("#22f400")
        Line:
            #cap: "none"
            width: 4
            circle: (self.width/2, self.height/2, min(85, 85) / 2, 0, root.arcSpool, 360)
    Image:
        pos: 0,0
        source: "pictures/SpoolRoll.png"
        size: root.size

<Spool2@FloatLayout>:
    filmDiameter: 0
    arcSpool: 0
    size_hint: None, None
    width: 120
    height: 120
    canvas:
        Color:
            rgb: getHexCol("#22f400")
        Line:
            cap: "none"
            width: 16
            circle: (self.width/2, self.height/2, min(self.width -34, self.height -34) / 2, 0, root.arcSpool, 50)
        Color:
            rgb: 1,1,1
        Line:
            width: 3.5
            circle: self.width/2, self.height/2, 30, 0, 360, 360
        Color:
            rgb: 1,1,1
        Line:
            width: 3.5
            circle: self.width/2, self.height/2, 55, 0, 360, 360

<DownHolder@RelativeLayout>:
    curDhPosition: app.curDhPosition
    setPosition : 0
    size_hint: None, None
    width: 158
    height: 25
    canvas:
        Color:
            rgb: app.baseGrey
        RoundedRectangle:
            pos: 0, 0
            size: self.width, 10
            radius: [3]
        RoundedRectangle:
            pos: 0, 15
            size: self.width, 10
            radius: [3]
        Color:
            rgb: app.baseColor
        RoundedRectangle:
            pos: 0, root.setPosition
            size: self.width, 10
            radius: [3]


<ScreenFilmAnimation>:
    FloatLayout:
        orientation: "vertical"
        Image:
            height: 160
            width: 530
            y: 0
            source: "pictures/Film Transport PNG Sequence.zip"
            anim_delay: -1/25
            #color: app.baseColor
        DownHolder:
            center_x: 680 /2
            center_y: 178


<ScreenSelectLedColor>:
    GridLayout:
        rows: 3
        cols: 1
        #minimum_height: 40
        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10,10,10,10
            size_hint_y: None
            height: 100
            ToggleButton:
                background_color: 0,0,0,0
                background_down: ""
                background_normal: ""
                group: "ledColor"
                state: "down" if app.curLedColor == 1 else "normal"
                on_press: app.setLedColor(1)
                canvas.before:
                    Color:
                        rgba: app.ledColorWhite
                        a: 0.5 if self.state == "normal" else 1.0
                    RoundedRectangle:
                        pos: self.x, self.y
                        size: self.width, self.height
                        radius: [8]

            ToggleButton:
                background_color: 0,0,0,0
                background_down: ""
                background_normal: ""
                group: "ledColor"
                on_press: app.setLedColor(2)
                state: "down" if app.curLedColor == 2 else "normal"
                canvas.before:
                    Color:
                        rgb: app.ledColorRed
                        a: 0.5 if self.state == "normal" else 1.0
                    RoundedRectangle:
                        pos: self.x, self.y
                        size: self.width, self.height
                        radius: [8]

            ToggleButton:
                background_color: 0,0,0,0
                background_down: ""
                background_normal: ""
                group: "ledColor"
                on_press: app.setLedColor(3)
                state: "down" if app.curLedColor == 3 else "normal"
                canvas.before:
                    Color:
                        rgb: app.ledColorGreen
                        a: 0.5 if self.state == "normal" else 1.0
                    RoundedRectangle:
                        pos: self.x, self.y
                        size: self.width, self.height
                        radius: [8]
            ToggleButton:
                background_color: 0,0,0,0
                background_down: ""
                background_normal: ""
                group: "ledColor"
                on_press: app.setLedColor(4)
                state: "down" if app.curLedColor == 4 else "normal"
                canvas.before:
                    Color:
                        rgb: app.ledColorBlue
                        a: 0.5 if self.state == "normal" else 1.0
                    RoundedRectangle:
                        pos: self.x, self.y
                        size: self.width, self.height
                        radius: [8]
        GridLayout:
            rows: 1
            cols: 3
            height: 90
            padding: 10,0,10,0
            Image:
                source: "pictures/icon_slider_small.png"
                size_hint_x: None
                width: 75
            Slider:
                id: sliderLedBrightness
                width: 500
                orientation: 'horizontal'
                min: 0
                max: 100
                step: 1
                on_value: app.setLedBrightness(self.value)
            Image:
                source: "pictures/icon_slider_big.png"
                size_hint_x: None
                width: 75

        BoxLayout:
            rows: 1
            cols: 2

            Label:
                font_name: "StdFont"
                font_size: 24
                markup: True
                color: app.baseGrey
                text: "BRIGHTNESS "
                size_hint_x: None
                width: 380
                text_size: self.size
                halign: 'right'
                valign: 'middle'
            Label:
                font_name: "StdFont"
                font_size: 24
                color: app.baseWhite
                halign: "right"
                multiline: True
                text: str(round(sliderLedBrightness.value)) + "%"
                #text: "%s" % sliderLedBrightness.value + "%"
                size_hint_x: None
                width: 70
                text_size: self.size
                halign: 'right'
                valign: 'middle'


<ScreenButtonsFilmIsInsert>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10
            padding: 10,10,10,5
            size_hint_y: None
            height: 65
            MoveFilmButton:
                text: "<<<"
                disabled: app.disable_btnFilmMoveBackward
                on_press: app.sendMoveCommand(36)
            MoveFilmButton:
                text: "<<"
                disabled: app.disable_btnFilmMoveBackward
                on_press: app.sendMoveCommand(34)
            MoveFilmButton:
                text: "<"
                disabled: app.disable_btnFilmMoveBackward
                on_press: app.sendMoveCommand(32)
            StopButton:
                text: "STOP"
                disabled: app.disable_btnStop
                on_press: app.sendMoveCommand(0)
            MoveFilmButton:
                text: ">"
                disabled: app.disable_btnFilmMoveForward
                on_press: app.sendMoveCommand(31)
            MoveFilmButton:
                text: ">>"
                disabled: app.disable_btnFilmMoveForward
                on_press: app.sendMoveCommand(33)
            MoveFilmButton:
                text: ">>>"
                disabled: app.disable_btnFilmMoveForward
                on_press: app.sendMoveCommand(35)
        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10,5,10,10
            size_hint_y: None
            height: 80
            NextPicButton:
                imageSource: "pictures/baseline_first_page_white_48pt_3x.png"
                disabled: app.disable_btnFilmControl
                on_press: app.sendMoveCommand(20)
            SelectFilmButton:

            NextPicButton:
                imageSource: "pictures/baseline_last_page_white_18pt_3x.png"
                disabled: app.disable_btnFilmControl
                on_press: app.sendMoveCommand(10)


<ScreenButtonsNoFilmInsert>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10
            padding: 10,10,10,5
            size_hint_y: None
            height: 65
            InfoTextLabel:
                text: "No Film Insert - Please Load Film..."

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10,5,10,10
            size_hint_y: None
            height: 80
            StartFilmLoadButton:
                on_press: app.startFilmLoad()


<ScreenButtonsLoadFilm>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10
            padding: 10,10,10,5
            size_hint_y: None
            height: 65
            InfoTextLabel:
                text: "LOADING FILM..."

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10,5,10,10
            size_hint_y: None
            height: 80
            FilmLoadButton:
                btnText: "< CANCEL"
                on_press: app.stopFilmLoad()
            LoadFilmFfwButton:
                on_press: app.enable_filmLoadFastForward()
                on_release: app.disable_filmLoadFastForward()
            FilmLoadButton:
                btnText: "INIT FILM >"
                on_press: app.startFilmInit()


<CameraControl>:
    BoxLayout:
        Label:
            text: "Page CameraControl"

<ProjectControl>:
    BoxLayout:
        Label:
            text: "Page ProjectControl"


<FilmTransportControl>:
    GridLayout:
        rows: 5
        cols: 1
        #minimum_height: 40

        Image:
            keep_ratio: True
            width: root.width
            source: "pictures/Header_FilmControl.png"

        BoxLayout:
            orientation: "horizontal"
            spacing: 10
            padding: 10
            size_hint_y: None
            height: 85
            IconButtonToggle:
                imageSource: "pictures/icon_light.png"
                on_press: app.toggleLight(self)
                state: "down" if app.curLedColor > 0 else "normal"
            IconButtonToggle:
                imageSource: "pictures/icon_selectColor.png"
                on_press: app.toggleLedColor(self)
            DhButton:
                imageSource: "pictures/baseline_expand_more_white_48pt_3x.png"
                arrowAngle: app.btnDhArrowAngle
                on_press: app.toggleDownHolder()
            IconButton:
                imageSource: "pictures/baseline_pan_tool_white_48pt_3x.png"
            IconButton:
                imageSource: "pictures/icon_epo.png"
                on_press: app.visionSensorLoadJob()

        SmFilmMoveCenter:
            id: smFilmTransportCenterID
            size_hint_y: None
            height: 215
            current: app.curFilmTransportCenterScreen

        SmFilmMoveBottom:
            id: smFilmMoveBottomID
            size_hint_y: None
            height: 135
            current: app.curFilmTransportBottomScreen

